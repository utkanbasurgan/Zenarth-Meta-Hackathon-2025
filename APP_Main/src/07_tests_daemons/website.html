<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Website - Localhost:3000 Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1f1e7a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #28a745;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .controls h3 {
            margin-bottom: 20px;
            color: #1f1e7a;
            font-size: 1.3rem;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #1f1e7a;
            color: white;
        }

        .btn-primary:hover {
            background: #0f0e5a;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .logs-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .log-container {
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #e9ecef;
        }

        .log-header {
            background: #1f1e7a;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-content {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .main-log {
            border-left: 3px solid #28a745;
        }

        .live-log {
            border-left: 3px solid #dc3545;
        }

        .log-entry.main-log {
            color: #28a745;
        }

        .log-entry.live-log {
            color: #dc3545;
        }

        .footer {
            background: #1f1e7a;
            color: white;
            padding: 20px 30px;
            text-align: center;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .logs-section {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 30px;
            color: #0d47a1;
        }

        .info-box h4 {
            margin-bottom: 10px;
            color: #1f1e7a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Test Website</h1>
            <p>Testing connection to http://localhost:3000/test</p>
        </div>

        <div class="info-box">
            <h4>üìã How to Use This Website:</h4>
            <p><strong>1.</strong> Make sure you have a server running on <code>http://localhost:3000/test</code></p>
            <p><strong>2.</strong> This website will automatically try to connect and log everything</p>
            <p><strong>3.</strong> Use the buttons below to control the testing</p>
            <p><strong>4.</strong> All logs are saved in your browser's localStorage</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="connectionStatus"></div>
                <span>Connection Status</span>
            </div>
            <div class="status-item">
                <span>Endpoint: <strong>http://localhost:3000/test</strong></span>
            </div>
            <div class="status-item">
                <span>Auto-retry: <strong>Enabled</strong></span>
            </div>
        </div>

        <div class="controls">
            <h3>Test Controls</h3>
            <div class="button-group">
                <button class="btn btn-primary" id="runTestBtn">
                    üöÄ Run Manual Test
                </button>
                <button class="btn btn-success" id="downloadMainBtn">
                    üì• Download Main Log
                </button>
                <button class="btn btn-success" id="downloadLiveBtn">
                    üì• Download Live Log
                </button>
                <button class="btn btn-warning" id="clearLogsBtn">
                    üóëÔ∏è Clear All Logs
                </button>
            </div>
        </div>

        <div class="logs-section">
            <div class="log-container">
                <div class="log-header">
                    <span>üìã Main Log (Test Activities)</span>
                    <span id="mainLogCount">0 entries</span>
                </div>
                <div class="log-content" id="main_log_display">
                    <div class="log-entry main-log">Waiting for test activities...</div>
                </div>
            </div>

            <div class="log-container">
                <div class="log-header">
                    <span>‚ö†Ô∏è Live Log (Console Errors)</span>
                    <span id="liveLogCount">0 entries</span>
                </div>
                <div class="log-content" id="live_log_display">
                    <div class="log-entry live-log">Waiting for console errors...</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Test Website - Monitoring localhost:3000/test endpoint</p>
            <p>All activities and errors are logged in real-time</p>
        </div>
    </div>

    <script>
        // Test Website JavaScript
        // Connects to http://localhost:3000/test and logs everything

        class TestLogger {
            constructor() {
                this.mainLogFile = 'main_log.txt';
                this.liveLogFile = 'live_log.txt';
                this.testEndpoint = 'http://localhost:3000/test';
                this.isConnected = false;
                this.connectionAttempts = 0;
                this.maxRetries = 5;
                
                this.init();
            }

            init() {
                this.logToMain('Test website initialized');
                this.setupErrorHandling();
                this.startConnectionTest();
            }

            logToMain(message) {
                const timestamp = new Date().toISOString();
                const logEntry = `[${timestamp}] ${message}\n`;
                
                console.log(`MAIN LOG: ${logEntry.trim()}`);
                
                // Store in localStorage for persistence
                const existingLogs = localStorage.getItem('main_log') || '';
                localStorage.setItem('main_log', existingLogs + logEntry);
                
                // Also log to the page for visibility
                this.displayLog('main', logEntry);
            }

            logToLive(message) {
                const timestamp = new Date().toISOString();
                const logEntry = `[${timestamp}] LIVE ERROR: ${message}\n`;
                
                console.error(`LIVE LOG: ${logEntry.trim()}`);
                
                // Store in localStorage for persistence
                const existingLogs = localStorage.getItem('live_log') || '';
                localStorage.setItem('live_log', existingLogs + logEntry);
                
                // Also log to the page for visibility
                this.displayLog('live', logEntry);
            }

            displayLog(type, message) {
                const logContainer = document.getElementById(`${type}_log_display`);
                if (logContainer) {
                    const logEntry = document.createElement('div');
                    logEntry.textContent = message.trim();
                    logEntry.className = `log-entry ${type}-log`;
                    logContainer.appendChild(logEntry);
                    logContainer.scrollTop = logContainer.scrollHeight;
                }
            }

            setupErrorHandling() {
                // Global error handler for console errors
                window.addEventListener('error', (event) => {
                    this.logToLive(`Console Error: ${event.error?.message || event.message} at ${event.filename}:${event.lineno}:${event.colno}`);
                });

                // Unhandled promise rejection handler
                window.addEventListener('unhandledrejection', (event) => {
                    this.logToLive(`Unhandled Promise Rejection: ${event.reason}`);
                });

                // Network error handler
                window.addEventListener('online', () => {
                    this.logToMain('Network connection restored');
                });

                window.addEventListener('offline', () => {
                    this.logToMain('Network connection lost');
                });
            }

            async startConnectionTest() {
                this.logToMain('Starting connection test to ' + this.testEndpoint);
                
                while (this.connectionAttempts < this.maxRetries && !this.isConnected) {
                    try {
                        this.connectionAttempts++;
                        this.logToMain(`Connection attempt ${this.connectionAttempts}/${this.maxRetries}`);
                        
                        const response = await fetch(this.testEndpoint, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            mode: 'cors'
                        });

                        if (response.ok) {
                            this.isConnected = true;
                            this.logToMain('Successfully connected to test endpoint');
                            
                            const data = await response.json();
                            this.logToMain(`Received response: ${JSON.stringify(data)}`);
                            
                            // Start periodic health checks
                            this.startHealthChecks();
                        } else {
                            this.logToMain(`Connection failed with status: ${response.status}`);
                        }
                    } catch (error) {
                        this.logToMain(`Connection error: ${error.message}`);
                        this.logToLive(`Network Error: ${error.message}`);
                        
                        if (this.connectionAttempts < this.maxRetries) {
                            const delay = Math.pow(2, this.connectionAttempts) * 1000; // Exponential backoff
                            this.logToMain(`Retrying in ${delay}ms...`);
                            await this.sleep(delay);
                        }
                    }
                }

                if (!this.isConnected) {
                    this.logToMain('Failed to connect after all retry attempts');
                    this.logToLive('Connection failed: Unable to reach test endpoint');
                }
            }

            startHealthChecks() {
                this.logToMain('Starting periodic health checks');
                
                setInterval(async () => {
                    try {
                        const response = await fetch(this.testEndpoint + '/health', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });

                        if (response.ok) {
                            this.logToMain('Health check passed');
                        } else {
                            this.logToMain(`Health check failed with status: ${response.status}`);
                            this.logToLive(`Health check failed: HTTP ${response.status}`);
                        }
                    } catch (error) {
                        this.logToMain(`Health check error: ${error.message}`);
                        this.logToLive(`Health check error: ${error.message}`);
                    }
                }, 30000); // Check every 30 seconds
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // Method to manually trigger a test
            async runTest() {
                this.logToMain('Manual test triggered');
                
                try {
                    const response = await fetch(this.testEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            testType: 'manual',
                            timestamp: new Date().toISOString(),
                            userAgent: navigator.userAgent
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.logToMain(`Manual test successful: ${JSON.stringify(result)}`);
                    } else {
                        this.logToMain(`Manual test failed with status: ${response.status}`);
                        this.logToLive(`Manual test failed: HTTP ${response.status}`);
                    }
                } catch (error) {
                    this.logToMain(`Manual test error: ${error.message}`);
                    this.logToLive(`Manual test error: ${error.message}`);
                }
            }

            // Method to download logs
            downloadLogs(type) {
                const logs = localStorage.getItem(`${type}_log`) || '';
                const blob = new Blob([logs], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${type}_log.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.logToMain(`Downloaded ${type}_log.txt`);
            }
        }

        // Initialize the test logger when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.testLogger = new TestLogger();
            
            // Add event listeners for manual controls
            const runTestBtn = document.getElementById('runTestBtn');
            if (runTestBtn) {
                runTestBtn.addEventListener('click', () => {
                    window.testLogger.runTest();
                });
            }

            const downloadMainBtn = document.getElementById('downloadMainBtn');
            if (downloadMainBtn) {
                downloadMainBtn.addEventListener('click', () => {
                    window.testLogger.downloadLogs('main');
                });
            }

            const downloadLiveBtn = document.getElementById('downloadLiveBtn');
            if (downloadLiveBtn) {
                downloadLiveBtn.addEventListener('click', () => {
                    window.testLogger.downloadLogs('live');
                });
            }

            const clearLogsBtn = document.getElementById('clearLogsBtn');
            if (clearLogsBtn) {
                clearLogsBtn.addEventListener('click', () => {
                    localStorage.removeItem('main_log');
                    localStorage.removeItem('live_log');
                    document.getElementById('main_log_display').innerHTML = '';
                    document.getElementById('live_log_display').innerHTML = '';
                    window.testLogger.logToMain('Logs cleared');
                });
            }

            // Update log counts periodically
            setInterval(() => {
                const mainLogs = document.querySelectorAll('#main_log_display .log-entry').length;
                const liveLogs = document.querySelectorAll('#live_log_display .log-entry').length;
                
                document.getElementById('mainLogCount').textContent = `${mainLogs} entries`;
                document.getElementById('liveLogCount').textContent = `${liveLogs} entries`;
            }, 1000);

            // Update connection status
            setInterval(() => {
                const statusIndicator = document.getElementById('connectionStatus');
                if (window.testLogger && window.testLogger.isConnected) {
                    statusIndicator.classList.add('connected');
                } else {
                    statusIndicator.classList.remove('connected');
                }
            }, 1000);
        });
    </script>
</body>
</html>
